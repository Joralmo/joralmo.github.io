<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Como dice en el titulo del post trataré de hacer un tutorial de como implementar un sistema autenticación y de roles utilizando ROR, para esto crearé ">
    

    <!--Author-->
    
        <meta name="author" content="JoralmoPro">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Autenticación y manejo de roles con RubyOnRails">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="JoralmoPro">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>Autenticación y manejo de roles con RubyOnRails - JoralmoPro</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Inicio
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Posts
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/acercade">
                    Acerca de
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-terminal" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2019/04/11/Autenticacion-y-manejo-de-roles-con-RubyOnRails/">
                Autenticación y manejo de roles con RubyOnRails
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-04-11</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h4 id="Como-dice-en-el-titulo-del-post-tratare-de-hacer-un-tutorial-de-como-implementar-un-sistema-autenticacion-y-de-roles-utilizando-ROR-para-esto-creare-un-proyecto-en-el-que-hay-usuarios-de-3-tipos-administrador-usuario-visitante-y-cada-usuario-tiene-posts-y-sera-una-pequena-API-por-lo-que-no-tendra-nada-en-el-front-para-la-autenticacion-utilizare-el-estandar-JWT-Json-Web-Token-con-la-gema-ruby-jwt-y-para-el-manejo-de-roles-una-libreria-de-autorizacion-que-es-la-gema-cancancan"><a href="#Como-dice-en-el-titulo-del-post-tratare-de-hacer-un-tutorial-de-como-implementar-un-sistema-autenticacion-y-de-roles-utilizando-ROR-para-esto-creare-un-proyecto-en-el-que-hay-usuarios-de-3-tipos-administrador-usuario-visitante-y-cada-usuario-tiene-posts-y-sera-una-pequena-API-por-lo-que-no-tendra-nada-en-el-front-para-la-autenticacion-utilizare-el-estandar-JWT-Json-Web-Token-con-la-gema-ruby-jwt-y-para-el-manejo-de-roles-una-libreria-de-autorizacion-que-es-la-gema-cancancan" class="headerlink" title="Como dice en el titulo del post trataré de hacer un tutorial de como implementar un sistema autenticación y de roles utilizando ROR, para esto crearé un proyecto en el que hay usuarios de 3 tipos (administrador, usuario, visitante) y cada usuario tiene posts y será una pequeña API por lo que no tendrá nada en el front, para la autenticación utilizaré el estandar JWT (Json Web Token) con la gema ruby-jwt, y para el manejo de roles una librería de autorización que es la gema cancancan."></a>Como dice en el titulo del post trataré de hacer un tutorial de como implementar un sistema autenticación y de roles utilizando ROR, para esto crearé un proyecto en el que hay usuarios de 3 tipos (administrador, usuario, visitante) y cada usuario tiene posts y será una pequeña API por lo que no tendrá nada en el front, para la autenticación utilizaré el estandar JWT (Json Web Token) con la gema <a href="https://github.com/jwt/ruby-jwt" target="_blank" rel="noopener">ruby-jwt</a>, y para el manejo de roles una librería de autorización que es la gema <a href="https://github.com/CanCanCommunity/cancancan/" target="_blank" rel="noopener">cancancan</a>.</h4><p>Y bueno empecemos, asumo que tienes rails y ruby instalado en tu pc, para este tutorial he utilizado las versiones:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -v</span><br><span class="line">&gt; ruby 2.6.1p33 (2019-01-30 revision 66950) [x86_64-linux]</span><br><span class="line">$ rails -v</span><br><span class="line">&gt; Rails 5.2.3</span><br></pre></td></tr></table></figure>
<p>Lo primero que debemos hacer es crear el proyecto con <code>rails new authTutorial</code></p>
<p>Siguiente a esto creamos los modelos</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rails g model Rol nombre:string</span><br><span class="line">rails g model Usuario correo:string password_digest:string rol:references</span><br><span class="line">rails g model Post titulo:string contenido:string usuario:references</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Importante el atributo password_digest que es el que le indica a rails que debe encriptar la contraseña al momento del registro.</p>
</blockquote>
<blockquote>
<p>Importante crearlos en este orden para que no haya problemas al momento de migrar la base de datos.</p>
</blockquote>
<p>Los anteriores comandos nos generarán tres modelos y tres migraciones.</p>
<p>Ahora debemos ir al modelo de usuarios en app/models/usuario.rb y decirle a rails que es un modelo al cual le debe encriptar la contraseña agregandole has_secure_password</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Usuario</span> &lt; ApplicationRecord</span></span><br><span class="line">  has_secure_password</span><br><span class="line">  belongs_to <span class="symbol">:rol</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>El <code>belogns_to</code> se agrega automaticamente al momento de crear el modelo con el generador</p>
<p>Lo que haremos ahora será configurar nuestra base de datos en /config/database.yml en el cual para este tutorial yo utilizaré la gema mysql2, por lo tanto en el Gemfile reemplazaré sqlite3 por mysql2</p>
<p>database.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">default:</span> <span class="meta">&amp;default</span></span><br><span class="line"><span class="attr">  adapter:</span> <span class="string">mysql2</span></span><br><span class="line"><span class="attr">  pool:</span> &lt;%=<span class="ruby"> ENV.fetch(<span class="string">"RAILS_MAX_THREADS"</span>) &#123; <span class="number">5</span> &#125; </span>%&gt;</span><br><span class="line"><span class="attr">  timeout:</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*default</span></span><br><span class="line"><span class="attr">  database:</span> <span class="string">authTutorial</span></span><br><span class="line"><span class="attr">  username:</span> <span class="string">tutorial</span></span><br><span class="line"><span class="attr">  password:</span> <span class="string">JoralmoPro</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*default</span></span><br><span class="line">  <span class="comment">#database: db/test.sqlite3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">production:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*default</span></span><br><span class="line">  <span class="comment">#database: db/production.sqlite3</span></span><br></pre></td></tr></table></figure>
<p>Una vez terminado con este archivo, pasamos al seed (ahora explico porque he comentado las bases de datos de los otros dos enviroments).</p>
<p>En el seed vamos a crear unos cuantos datos para la base de datos, utilizaré faker para estó, por lo tanto en el Gemfile toca agregar <code>gem&#39;faker&#39;</code> por lo menos yo lo he agregado solamente para el grupo de development y test, adicionalmente descomentar <code>gem &#39;bcrypt&#39;</code> para la contraseña del usuario, luego hacemos <code>bundle install</code></p>
<p>Una vez agregada la gema vamos al archivo db/seeds.rb</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">administrador = Rol.create(<span class="symbol">nombre:</span> <span class="string">"administrador"</span>)</span><br><span class="line">cliente = Rol.create(<span class="symbol">nombre:</span> <span class="string">"cliente"</span>)</span><br><span class="line">visitante = Rol.create(<span class="symbol">nombre:</span> <span class="string">"visitante"</span>)</span><br><span class="line"></span><br><span class="line">Usuario.create(<span class="symbol">correo:</span> <span class="string">"joralmopro@gmail.com"</span>, <span class="symbol">password:</span> <span class="string">"123456"</span>, <span class="symbol">rol:</span> administrador)</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>.times <span class="keyword">do</span></span><br><span class="line">    usuario = Usuario.create(<span class="symbol">correo:</span> Faker::Internet.email, <span class="symbol">password:</span> <span class="string">"cliente"</span>, <span class="symbol">rol:</span> cliente)</span><br><span class="line">    Post.create(<span class="symbol">titulo:</span> Faker::Book.title, <span class="symbol">contenido:</span> Faker::Lorem.paragraph, <span class="symbol">usuario:</span> usuario)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">p <span class="string">"<span class="subst">#&#123;Usuario.count&#125;</span> usuarios creados"</span></span><br><span class="line">p <span class="string">"<span class="subst">#&#123;Rol.count&#125;</span> roles creados"</span></span><br><span class="line">p <span class="string">"<span class="subst">#&#123;Post.count&#125;</span> post creados"</span></span><br></pre></td></tr></table></figure>
<p>Esto creará los tres roles mencionados al principio, un usuario administrador y 5 usuarios normales y al final nos mostrará en consola cuantas entidades a creado de cada modelo.</p>
<p>Teniendo ya esto listo procedemos a ejecutar en la consola</p>
<p><code>rails db:create; and rails db:migrate; and rails db:seed</code> <strong>(Yo uso fish en ubuntu, si usas bash normal reemplazar los ; and por &amp;&amp;)</strong></p>
<p>El anterior comando es el motivo por el que he comentado las bases de datos de los otros dos enviromentes pues al hacer db:create intentará crear las bases de datos y dará error pues no tengo sqlite3, en caso de necesitarlas solo escribes en consola <code>rails db:environment:set RAILS_ENV=development</code> para que siempre utilice el enviroment development.</p>
<p>Despues de ejecutar el comando anterior deberas ver algo como esto en la consola</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Created database <span class="string">'authTutorial'</span></span><br><span class="line">== 20190411210050 CreateRols: migrating =======================================</span><br><span class="line">-- create_table(:rols)</span><br><span class="line">   -&gt; 0.2598s</span><br><span class="line">== 20190411210050 CreateRols: migrated (0.2599s) ==============================</span><br><span class="line"></span><br><span class="line">== 20190411210141 CreateUsuarios: migrating ===================================</span><br><span class="line">-- create_table(:usuarios)</span><br><span class="line">   -&gt; 0.3437s</span><br><span class="line">== 20190411210141 CreateUsuarios: migrated (0.3438s) ==========================</span><br><span class="line"></span><br><span class="line">== 20190411210248 CreatePosts: migrating ======================================</span><br><span class="line">-- create_table(:posts)</span><br><span class="line">   -&gt; 0.3559s</span><br><span class="line">== 20190411210248 CreatePosts: migrated (0.3560s) =============================</span><br><span class="line"></span><br><span class="line"><span class="string">"6 usuarios creados"</span></span><br><span class="line"><span class="string">"3 roles creados"</span></span><br><span class="line"><span class="string">"5 post creados"</span></span><br></pre></td></tr></table></figure>
<p>Y hasta ahora todo bien, todo correcto :v</p>
<p>Pero empecemos con lo más interesante, vamos con la autenticación, para esto es necesario primero que todo incluir en el Gemfile dos gemas:</p>
<ol>
<li><code>gem &#39;jwt&#39;</code></li>
<li><code>gem &#39;dotenv-rails&#39;</code></li>
</ol>
<p>la primera es para jwt y la segunda es para poder utilizar el archivo .env que es donde colocaremos la key necesaria para el jwt, no olvidar el <code>bundle install</code> y luego en la raiz del proyecto crear el archivo <code>.env</code> y agregar <code>JWT_SECRET=&#39;l4m3j0rc14v3d31mund0&#39;</code> donde la clave puede ser lo que quieras.</p>
<p>Contnuamos ahora creando en /app una carpeta llamada jwt y dentro el archivo json_web_token.rb que es donde tendremos la clase JsonWebToken, el archivo contendra lo siguiente</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonWebToken</span></span></span><br><span class="line">    JWT_SECRET = ENV[<span class="string">"JWT_SECRET"</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">encode</span><span class="params">(payload, exp = <span class="number">24</span>.hours.from_now)</span></span></span><br><span class="line">        payload[<span class="symbol">:exp</span>] = exp.to_i</span><br><span class="line">        JWT.encode(payload, JWT_SECRET)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">decode</span><span class="params">(token)</span></span></span><br><span class="line">        body = JWT.decode(token, JWT_SECRET)[<span class="number">0</span>]</span><br><span class="line">        HashWithIndifferentAccess.new body</span><br><span class="line">    <span class="keyword">rescue</span> JWT::ExpiredSignature, JWT::VerificationError =&gt; e</span><br><span class="line">        raise ManejadorDeExcepciones::TokenExpirado, e.message</span><br><span class="line">    <span class="keyword">rescue</span> JWT::DecodeError, JWT::VerificationError =&gt; e</span><br><span class="line">        raise ManejadorDeExcepciones::TokenNoValido, e.message</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Dos funciones, <code>encode</code> y <code>decode</code>.</p>
<p>La primera recibe dos parametros (aunque el segundo puede ser vacio y por defecto le pondrá 24 horas), y crea el token.</p>
<p>La segunda solo recibe como parametro un token y lo decodifica, luego se hace un rescue para manejar los errores en caso de que el token haya vencido o no sea valido, este manejador de errores lo crearemos a continuación, por lo tanto procedemos a crear un archivo en app/controllers/concerns/manejador_de_excepciones.rb</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">ManejadorDeExcepciones</span> <span class="title">extend</span> <span class="title">ActiveSupport::Concern</span></span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TokenNoValido</span> &lt; StandardError;</span> <span class="keyword">end</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TokenExpirado</span> &lt; StandardError;</span> <span class="keyword">end</span></span><br><span class="line">    included <span class="keyword">do</span></span><br><span class="line">        rescue_from ManejadorDeExcepciones::TokenNoValido <span class="keyword">do</span> <span class="params">|_error|</span></span><br><span class="line">            render <span class="symbol">json:</span> &#123;<span class="symbol">mensaje:</span> <span class="string">"¡Acceso denegado!. Token inválido suministrado."</span>&#125;, <span class="symbol">status:</span> <span class="symbol">:unauthorized</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        rescue_from ManejadorDeExcepciones::TokenExpirado <span class="keyword">do</span> <span class="params">|_error|</span></span><br><span class="line">            render <span class="symbol">json:</span> &#123;<span class="symbol">mensaje:</span> <span class="string">"¡Acceso denegado!. Token expirado"</span>&#125;, <span class="symbol">status:</span> <span class="symbol">:unauthorized</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Esté archivo recibira los errores de la clase JWT y los manejará para devolver el mensaje de error, ahora tenemos que incluirlo en el appliation_controller para poder utilizarlo en las demás clases</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationController</span> &lt; ActionController::Base</span></span><br><span class="line">    <span class="keyword">include</span> ManejadorDeExcepciones</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Ahora procedemos a crear una carpeta llamada auth (o como quieran) dentro de app y dentro un archivo authentication.rb que es donde estará la clase Authentication que será la encargada de autenticar al usuario y generar el token, esperemos que se entienda con solo verla.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Authentication</span></span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(usuario)</span></span></span><br><span class="line">        @correo = usuario[<span class="symbol">:correo</span>]</span><br><span class="line">        @password = usuario[<span class="symbol">:password</span>]</span><br><span class="line">        @usuario = Usuario.find_by(<span class="symbol">correo:</span> @correo)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">autenticar</span></span></span><br><span class="line">        @usuario &amp;&amp; @usuario.authenticate(@password)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generar_token</span></span></span><br><span class="line">        JsonWebToken.encode(&#123;<span class="symbol">usuario_id:</span> @usuario.id, <span class="symbol">correo:</span> @usuario.correo&#125;)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>teniendo esto, esperariamos que nuestra autenticación ya funcionara, entonces la probamos creando una ruta al controlador de sesión en config/routes.rb (como estoy manejando las carpetas ap1 y v1 en mi proyecto colocaré los namespace, si quieres los puedes obviar)</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  namespace <span class="symbol">:api</span> <span class="keyword">do</span></span><br><span class="line">    namespace <span class="symbol">:v1</span> <span class="keyword">do</span></span><br><span class="line">      post <span class="string">'login'</span>, <span class="symbol">to:</span> <span class="string">'session#login'</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Ahora creamos los controladores para ir probando que todo funciona hasta aquí, quedaría algo así (obviar las carpetas api y v1 si lo deseas)</p>
<p><img src="/images/controladores.png" alt=""></p>
<p>y en session_controller</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api::V1::SessionController</span> &lt; ApplicationController</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span></span></span><br><span class="line">        auth = Authentication.new(login_params)</span><br><span class="line">        <span class="keyword">if</span>(auth.autenticar)</span><br><span class="line">            render <span class="symbol">json:</span> &#123;<span class="symbol">mensaje:</span> <span class="string">"¡Inicio de sesión correcto!"</span>, <span class="symbol">token:</span> auth.generar_token&#125;, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            render <span class="symbol">json:</span> &#123;<span class="symbol">mensaje:</span> <span class="string">"Correo o Contraseña incorrectos"</span>&#125;, <span class="symbol">status:</span> <span class="symbol">:unauthorized</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    private</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login_params</span></span></span><br><span class="line">        params.permit(<span class="symbol">:correo</span>, <span class="symbol">:password</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>y luego para poder probar, ruby espera un csrf_token en cada solicitud pero aquí no lo utilizaremos por lo que nos toca deshabilitarlo agregando en application_controller <code>protect_from_forgery with: :null_session</code> y ahora si podremos probar (en mi caso lo haré con postman y enviando el usuario que he creado en el seed como admin)</p>
<p><img src="/images/primerPruebaLogin.png" alt=""></p>
<p>¡Y hasta aquí todo está funcionando correctamente!</p>
<p>pero hasta este punto todo el mundo puede hacer lo que le de la gana despues de haber obtenido el token, hasta un visitante podría eliminar o actualizar algo (en caso de tener creados los metodos en los controladores) y es cuando entra en juego la gema cancancan que es la que nos permitirá gestionar que permisos tiene cada usuario dependiendo de su rol, y lo hace de una manera muy elegante, lo primero entonces es instalarla agregando <code>gem &#39;cancancan&#39;</code> en el Gemfile y luego como no ejecutar <code>bundle install</code>, a continuación despues de instalada debemos ejecutar en consola <code>rails g cancan:ability</code>  para que se cree el archivo ability.rb dentro de la carpeta app/models/, si da error pues lo crear manual xD.</p>
<p>Una vez ubicado el archivo vemos que tiene la clase Ability creada y el inicializador de está misma, como nuestro proyecto tiene 3 roles lo que haremos es que cada vez que soliciten autorización les devolveremos una función dependiendo del rol del usuario para saber que puede hacer y que no, así:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ability</span></span></span><br><span class="line">  <span class="keyword">include</span> CanCan::Ability</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(usuario)</span></span></span><br><span class="line">    send(<span class="string">"<span class="subst">#&#123;usuario.rol.nombre&#125;</span>_permisos"</span>, usuario)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">administrador_permisos</span><span class="params">(usuario)</span></span></span><br><span class="line">    can <span class="symbol">:manage</span>, <span class="symbol">:all</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cliente_permisos</span><span class="params">(usuario)</span></span></span><br><span class="line">    can <span class="symbol">:read</span>, Post, <span class="symbol">:all</span></span><br><span class="line">    can <span class="symbol">:manage</span>, Post, &#123; <span class="symbol">usuario_id:</span> usuario.id&#125;</span><br><span class="line">    can [<span class="symbol">:read</span>, <span class="symbol">:update</span>], Usuario, &#123; <span class="symbol">id:</span> usuario.id &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visitante_permisos</span><span class="params">(usuario)</span></span></span><br><span class="line">    can <span class="symbol">:read</span>, Post, <span class="symbol">:all</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">lista_de_permisos</span></span></span><br><span class="line">usuario_params</span><br><span class="line">        params.permit(<span class="symbol">:correo</span>, <span class="symbol">:password</span>, <span class="symbol">:rol_id</span>)</span><br><span class="line">    <span class="keyword">end</span>    rules.map <span class="keyword">do</span> <span class="params">|rule|</span></span><br><span class="line">     object = &#123; <span class="symbol">acciones:</span> rule.actions, <span class="symbol">sobre:</span> rule.subjects.map&#123; <span class="params">|s|</span> s.is_a?(Symbol) ? s : s.name &#125; &#125;</span><br><span class="line">      object[<span class="symbol">:condiciones</span>] = rule.conditions <span class="keyword">unless</span> rule.conditions.blank?</span><br><span class="line">      object[<span class="symbol">:inverted</span>] = <span class="literal">true</span> <span class="keyword">unless</span> rule.base_behavior</span><br><span class="line">      object</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Vemos  tres funciones una por cada rol, y lo que dice dentro de cada una es que el administrador puede hacer de todo, el cliente puede leer todos los post pero solo puede actualizar, crear, eliminar y borrar post que le pertenezcan a el y además solo podra ver y actualizar un usuario si es el mismo, en cuando al visitante solamente puede leer todos los post, esto es maravilloso nos ahorramos hacer un monton de if (que yo habría hecho si esta gema no existiera xD) en cada controlador dependiendo del rol del usuario; tambien vemos un metodo llamado lista_de_permisos que este lo que nos retorna es que puede hacer cada rol, ahora lo vemos.</p>
<p>Para probarlo en el controlador de usuarios escribiremos los siguientes metodos</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api::V1::UsuariosController</span> &lt; ApplicationController</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line">        usuarios = Usuario.all</span><br><span class="line">        render <span class="symbol">json:</span> usuarios, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></span><br><span class="line">        usuario = Usuario.new(usuario_params)</span><br><span class="line">        <span class="keyword">if</span> usuario.save</span><br><span class="line">            render <span class="symbol">json:</span> usuario, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            render <span class="symbol">json:</span> <span class="string">"error"</span>, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">        usuario = Usuario.find(params[<span class="symbol">:id</span>])</span><br><span class="line">        permisos = Ability.new(usuario).lista_de_permisos</span><br><span class="line">        render <span class="symbol">json:</span> &#123;<span class="symbol">usuario:</span> usuario, <span class="symbol">permisos:</span> permisos&#125;, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    private</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">usuario_params</span></span></span><br><span class="line">        params.permit(<span class="symbol">:correo</span>, <span class="symbol">:password</span>, <span class="symbol">:rol_id</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Y desde postman probamos con el usuario 1 que es el admin</p>
<p><img src="/images/lista_de_permisos_admin.png" alt=""></p>
<p>Con el usuario 2 que es un usuario normal (cliente)</p>
<p><img src="/images/lista_de_permisos_cliente.png" alt=""></p>
<p>y vemos que por cada petición nos retorna los permisos del usuario, las acciones que puede hacer,  sobre que modelo y si tiene alguna condición para poder hacer esa acción, quizá para algo puede servir esté metodo en algun momento.</p>
<p>Pero continuemos con el proceso, ahora para que cancancan pueda saber que hacer al momento de hacer una petición a algún controlador donde definamos la autorización el asume que tenemos la clase ability (que ya la tenemos en la carpeta app/models) y tambien un metodo llamado current_user y por lo tanto este metodo es el que procederemos a escribir ahora, entonces nos vamos a app/controllers/application_controller.rb y es aquí donde escribiremos el metodo para poder tenerlo disponible en toda la aplicación quedando así</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationController</span> &lt; ActionController::Base</span></span><br><span class="line">    protect_from_forgery <span class="symbol">with:</span> <span class="symbol">:null_session</span></span><br><span class="line">    <span class="keyword">include</span> ManejadorDeExcepciones</span><br><span class="line"></span><br><span class="line">    rescue_from CanCan::AccessDenied <span class="keyword">do</span> <span class="params">|exception|</span></span><br><span class="line">        render <span class="symbol">json:</span> &#123; <span class="symbol">mensaje:</span> exception.message &#125;, <span class="symbol">status:</span> <span class="number">403</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">current_user</span></span></span><br><span class="line">        <span class="keyword">if</span> token</span><br><span class="line">            @usuario_actual <span class="params">||</span>= Usuario.find(token[<span class="symbol">:usuario_id</span>])</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            @usuario_actual <span class="params">||</span>= Usuario.new(<span class="symbol">rol_id:</span> <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    private</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">token</span></span></span><br><span class="line">        valor = request.headers[<span class="symbol">:Authorization</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> valor.blank?</span><br><span class="line">        @token <span class="params">||</span>= JsonWebToken.decode(valor.split(<span class="string">" "</span>).last)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Lo que agregamos ahora es un rescue para manejar el error cuando el acceso sea denegado y devolver un error de no autorizado, el metodo current user que recupera el usuario actual dependiendo del token que venga en la solicitud y en caso de no haber ningun token se tomará como usuario visitante por eso se le asigna el rol tres (asumo que el rol con id tres es el visitante, lo pueden hacer dinamico con una consulta a la tabla rols).</p>
<p>Luego de esto volvemos el metodo show el usuarios_controller normal y le agregamos la directiva para que cancancan aplique la autorización en esa clase, así</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api::V1::UsuariosController</span> &lt; ApplicationController</span></span><br><span class="line">    load_and_authorize_resource <span class="class"><span class="keyword">class</span>: "<span class="title">Usuario</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line">        usuarios = Usuario.all</span><br><span class="line">        render <span class="symbol">json:</span> usuarios, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></span><br><span class="line">        usuario = Usuario.new(usuario_params)</span><br><span class="line">        <span class="keyword">if</span> usuario.save</span><br><span class="line">            render <span class="symbol">json:</span> usuario, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            render <span class="symbol">json:</span> <span class="string">"error"</span>, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">        usuario = Usuario.find(params[<span class="symbol">:id</span>])</span><br><span class="line">        render <span class="symbol">json:</span> usuario, <span class="symbol">status:</span> <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    private</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">usuario_params</span></span></span><br><span class="line">        params.permit(<span class="symbol">:correo</span>, <span class="symbol">:password</span>, <span class="symbol">:rol_id</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Y probamos!</p>
<p>Pedimos el usuario con id 3 y enviamos el token del administrador, y lo devolverá sin problemas pues el puede realizar está acción</p>
<p><img src="/images/autorizacion_admin.png" alt=""></p>
<p>pero si lo hacemos con el token de un usuario normal</p>
<p><img src="/images/autorizacion_usuario_normal.png" alt=""></p>
<p>igual sucede con el usuario visitante</p>
<p><img src="/images/autorizacion_visitante.png" alt=""></p>
<p>El enviroment en postman contiene los tokens (el del visitante simplemente no es nada)</p>
<p><img src="/images/enviroment_postman.png" alt=""></p>
<p>Y con estás pruebas podemos ver que todo está funcionando correctamente!, ahora simplemente por deseo personal me gustaría ver el mensaje de error en español y de forma personalizada, por lo que toca hacer lo siguiente, en config/locales/ crearé el archivo es.yml y tendrá lo siguiente</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">es:</span></span><br><span class="line"><span class="attr">  unauthorized:</span></span><br><span class="line"><span class="attr">    manage:</span></span><br><span class="line"><span class="attr">      all:</span> <span class="string">"No estás autorizado para: [<span class="template-variable">%&#123;action&#125;</span>] =&gt; [<span class="template-variable">%&#123;subject&#125;</span>]."</span></span><br></pre></td></tr></table></figure>
<p>además de esto en application_controller agregamos un before_action y le pasamos una función para cambiar el locale de rails, quedaría así</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationController</span> &lt; ActionController::Base</span></span><br><span class="line">    before_action <span class="symbol">:set_locale</span></span><br><span class="line">    protect_from_forgery <span class="symbol">with:</span> <span class="symbol">:null_session</span></span><br><span class="line">    <span class="keyword">include</span> ManejadorDeExcepciones</span><br><span class="line"></span><br><span class="line">    rescue_from CanCan::AccessDenied <span class="keyword">do</span> <span class="params">|exception|</span></span><br><span class="line">        render <span class="symbol">json:</span> &#123; <span class="symbol">mensaje:</span> exception.message &#125;, <span class="symbol">status:</span> <span class="number">403</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">current_user</span></span></span><br><span class="line">        <span class="keyword">if</span> token</span><br><span class="line">            @usuario_actual <span class="params">||</span>= Usuario.find(token[<span class="symbol">:usuario_id</span>])</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            @usuario_actual <span class="params">||</span>= Usuario.new(<span class="symbol">rol_id:</span> <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    private</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">token</span></span></span><br><span class="line">        valor = request.headers[<span class="symbol">:Authorization</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> valor.blank?</span><br><span class="line">        @token <span class="params">||</span>= JsonWebToken.decode(valor.split(<span class="string">" "</span>).last)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_locale</span></span></span><br><span class="line">        I18n.locale = <span class="string">"es"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Haremos otra prueba y veremos los errores, en este caso trataremos de crear un nuevo usuario</p>
<p>Token de visitante</p>
<p><img src="/images/crear_usuario_visitante.png" alt=""></p>
<p>Token usuario</p>
<p><img src="/images/crear_usuario_usuario.png" alt=""></p>
<p>Y por ultimo con el administrador</p>
<p><img src="/images/crear_usuario_admin.png" alt=""></p>
<p>Y así mismo pasaría con los demás metodos, nuestra aplicación tendrá un manejo de autenticación un autorización un poco más organizado y mejor elaborado graciás a estás gemas.</p>
<p>Si algó no está bien escrito o hay algun error pido disculpas, para dudas o comentarios estoy en las redes como @JoralmoPro.</p>
<p>Para escribir este tutorial me he guidao y tal vez copiado algun trozo de código de <a href="https://medium.com/@noordean/authentication-with-jwt-in-rails-api-71102387c0b0" target="_blank" rel="noopener">aquí</a>, <a href="https://github.com/stalniy/rails-cancan-api-example" target="_blank" rel="noopener">aquí</a>, <a href="https://github.com/CanCanCommunity/cancancan/wiki/exception-handling" target="_blank" rel="noopener">aquí</a>, <a href="https://culttt.com/2016/01/20/implementing-roles-and-permissions-in-ruby-on-rails/" target="_blank" rel="noopener">aquí</a> y <a href="https://riptutorial.com/ruby-on-rails/example/10259/getting-started-with-cancan" target="_blank" rel="noopener">aquí</a>.</p>
<p><a href="https://gitlab.com/JoralmoPro/authrubyonrailstutorial" target="_blank" rel="noopener">Repositorio</a></p>
<blockquote>
<p>¡Nos vemos el linea!</p>
</blockquote>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/ruby/">#ruby</a> <a href="/tags/ruby-on-rails/">#ruby on rails</a> <a href="/tags/jwt/">#jwt</a> <a href="/tags/programacion/">#programación</a>
        </div>
    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <script>
    (function() {
        var d = document,
        s = d.createElement("script");
        s.src = "https://blogjoralmopro.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
</div>



    </div>
    
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>Acerca_de</h2>
                <p>
                    JoralmoPro, estudiante de 9no semestre de ingeniería de sistemas. <br> <small>Este tema fue desarrollado por <a href="https://github.com/klugjo">Jonathan Klughertz</a>. El código fuente está disponible en Github. Crear sitios web. Hacer magia</small>
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Posts_recientes</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/04/11/Autenticacion-y-manejo-de-roles-con-RubyOnRails/">Autenticación y manejo de</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/11/10/Ionic-Cloud-Vision-de-Google/">Ionic + Cloud Vision de G</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/11/07/Como-crear-un-chatbot-Node-js-y-DialogFlow/">Como crear un chatbot - N</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/Joralmo">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                        <li class="list-inline-item">
                            <a href="https://gitlab.com/JoralmoPro">
                                <span class="footer-icon-container">
                                    <i class="fa fa-gitlab"></i>
                                </span>
                            </a>
                        </li>
                        
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/JoralmoPro">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/iJoseAltamar">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/JoralmoPro">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:JoralmoPro@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @<a target="_blank" href="http://bit.ly/portafolioJP">JoralmoPro</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>