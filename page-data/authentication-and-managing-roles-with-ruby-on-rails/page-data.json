{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/authentication-and-managing-roles-with-ruby-on-rails","result":{"data":{"post":{"slug":"/authentication-and-managing-roles-with-ruby-on-rails","title":"Autenticación y manejo de roles con RubyOnRails","date":"11.04.2019","tags":[{"name":"ruby","slug":"ruby"},{"name":"ruby on rails","slug":"ruby-on-rails"},{"name":"jwt","slug":"jwt"},{"name":"programación","slug":"programacion"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Autenticación y manejo de roles con RubyOnRails\",\n  \"date\": \"2019-04-11T22:55:44.000Z\",\n  \"tags\": [\"ruby\", \"ruby on rails\", \"jwt\", \"programación\"],\n  \"slug\": \"/authentication-and-managing-roles-with-ruby-on-rails\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h4\", null, \"Como dice en el titulo del post tratar\\xE9 de hacer un tutorial de como implementar un sistema autenticaci\\xF3n y de roles utilizando ROR, para esto crear\\xE9 un proyecto en el que hay usuarios de 3 tipos (administrador, usuario, visitante) y cada usuario tiene posts y ser\\xE1 una peque\\xF1a API por lo que no tendr\\xE1 nada en el front, para la autenticaci\\xF3n utilizar\\xE9 el estandar JWT (Json Web Token) con la gema \", mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"https://github.com/jwt/ruby-jwt\"\n  }, \"ruby-jwt\"), \", y para el manejo de roles una librer\\xEDa de autorizaci\\xF3n que es la gema \", mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"https://github.com/CanCanCommunity/cancancan/\"\n  }, \"cancancan\"), \".\"), mdx(\"p\", null, \"Y bueno empecemos, asumo que tienes rails y ruby instalado en tu pc, para este tutorial he utilizado las versiones:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ ruby -v\\n> ruby 2.6.1p33 (2019-01-30 revision 66950) [x86_64-linux]\\n$ rails -v\\n> Rails 5.2.3\\n\")), mdx(\"p\", null, \"Lo primero que debemos hacer es crear el proyecto con \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rails new authTutorial\")), mdx(\"p\", null, \"Siguiente a esto creamos los modelos\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"  rails g model Rol nombre:string\\n  rails g model Usuario correo:string password_digest:string rol:references\\n  rails g model Post titulo:string contenido:string usuario:references\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Importante el atributo password_digest que es el que le indica a rails que debe encriptar la contrase\\xF1a al momento del registro.\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Importante crearlos en este orden para que no haya problemas al momento de migrar la base de datos.\")), mdx(\"p\", null, \"Los anteriores comandos nos generar\\xE1n tres modelos y tres migraciones.\"), mdx(\"p\", null, \"Ahora debemos ir al modelo de usuarios en app/models/usuario.rb y decirle a rails que es un modelo al cual le debe encriptar la contrase\\xF1a agregandole has_secure_password\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Usuario < ApplicationRecord\\n  has_secure_password\\n  belongs_to :rol\\nend\\n\")), mdx(\"p\", null, \"El \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"belogns_to\"), \" se agrega automaticamente al momento de crear el modelo con el generador\"), mdx(\"p\", null, \"Lo que haremos ahora ser\\xE1 configurar nuestra base de datos en /config/database.yml en el cual para este tutorial yo utilizar\\xE9 la gema mysql2, por lo tanto en el Gemfile reemplazar\\xE9 sqlite3 por mysql2\"), mdx(\"p\", null, \"database.yml\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"default: &default\\n  adapter: mysql2\\n  pool: <%= ENV.fetch(\\\"RAILS_MAX_THREADS\\\") { 5 } %>\\n  timeout: 5000\\n\\ndevelopment:\\n  <<: *default\\n  database: authTutorial\\n  username: tutorial\\n  password: JoralmoPro\\n  \\ntest:\\n  <<: *default\\n  #database: db/test.sqlite3\\n\\nproduction:\\n  <<: *default\\n  #database: db/production.sqlite3\\n  \\n\")), mdx(\"p\", null, \"Una vez terminado con este archivo, pasamos al seed (ahora explico porque he comentado las bases de datos de los otros dos enviroments).\"), mdx(\"p\", null, \"En el seed vamos a crear unos cuantos datos para la base de datos, utilizar\\xE9 faker para est\\xF3, por lo tanto en el Gemfile toca agregar \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gem'faker'\"), \" por lo menos yo lo he agregado solamente para el grupo de development y test, adicionalmente descomentar \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gem 'bcrypt'\"), \" para la contrase\\xF1a del usuario, luego hacemos \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bundle install\")), mdx(\"p\", null, \"Una vez agregada la gema vamos al archivo db/seeds.rb\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"administrador = Rol.create(nombre: \\\"administrador\\\")\\ncliente = Rol.create(nombre: \\\"cliente\\\")\\nvisitante = Rol.create(nombre: \\\"visitante\\\")\\n\\nUsuario.create(correo: \\\"joralmopro@gmail.com\\\", password: \\\"123456\\\", rol: administrador)\\n\\n5.times do\\n    usuario = Usuario.create(correo: Faker::Internet.email, password: \\\"cliente\\\", rol: cliente)\\n    Post.create(titulo: Faker::Book.title, contenido: Faker::Lorem.paragraph, usuario: usuario)\\nend\\n\\np \\\"#{Usuario.count} usuarios creados\\\"\\np \\\"#{Rol.count} roles creados\\\"\\np \\\"#{Post.count} post creados\\\"\\n\")), mdx(\"p\", null, \"Esto crear\\xE1 los tres roles mencionados al principio, un usuario administrador y 5 usuarios normales y al final nos mostrar\\xE1 en consola cuantas entidades a creado de cada modelo.\"), mdx(\"p\", null, \"Teniendo ya esto listo procedemos a ejecutar en la consola\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rails db:create; and rails db:migrate; and rails db:seed\"), \" \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"(Yo uso fish en ubuntu, si usas bash normal reemplazar los ; and por &&)\")), mdx(\"p\", null, \"El anterior comando es el motivo por el que he comentado las bases de datos de los otros dos enviromentes pues al hacer db:create intentar\\xE1 crear las bases de datos y dar\\xE1 error pues no tengo sqlite3, en caso de necesitarlas solo escribes en consola \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rails db:environment:set RAILS_ENV=development\"), \" para que siempre utilice el enviroment development.\"), mdx(\"p\", null, \"Despues de ejecutar el comando anterior deberas ver algo como esto en la consola\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"Created database 'authTutorial'\\n== 20190411210050 CreateRols: migrating =======================================\\n-- create_table(:rols)\\n   -> 0.2598s\\n== 20190411210050 CreateRols: migrated (0.2599s) ==============================\\n\\n== 20190411210141 CreateUsuarios: migrating ===================================\\n-- create_table(:usuarios)\\n   -> 0.3437s\\n== 20190411210141 CreateUsuarios: migrated (0.3438s) ==========================\\n\\n== 20190411210248 CreatePosts: migrating ======================================\\n-- create_table(:posts)\\n   -> 0.3559s\\n== 20190411210248 CreatePosts: migrated (0.3560s) =============================\\n\\n\\\"6 usuarios creados\\\"\\n\\\"3 roles creados\\\"\\n\\\"5 post creados\\\"\\n\\n\")), mdx(\"p\", null, \"Y hasta ahora todo bien, todo correcto :v\"), mdx(\"p\", null, \"Pero empecemos con lo m\\xE1s interesante, vamos con la autenticaci\\xF3n, para esto es necesario primero que todo incluir en el Gemfile dos gemas:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"gem 'jwt'\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"gem 'dotenv-rails'\"))), mdx(\"p\", null, \"la primera es para jwt y la segunda es para poder utilizar el archivo .env que es donde colocaremos la key necesaria para el jwt, no olvidar el \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bundle install\"), \" y luego en la raiz del proyecto crear el archivo \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env\"), \" y agregar \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWT_SECRET='l4m3j0rc14v3d31mund0'\"), \" donde la clave puede ser lo que quieras.\"), mdx(\"p\", null, \"Continuamos ahora creando en /app una carpeta llamada jwt y dentro el archivo json_web_token.rb que es donde tendremos la clase JsonWebToken, el archivo contendra lo siguiente\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class JsonWebToken\\n    JWT_SECRET = ENV[\\\"JWT_SECRET\\\"]\\n    def self.encode(payload, exp = 24.hours.from_now)\\n        payload[:exp] = exp.to_i\\n        JWT.encode(payload, JWT_SECRET)\\n    end\\n    def self.decode(token)\\n        body = JWT.decode(token, JWT_SECRET)[0]\\n        HashWithIndifferentAccess.new body\\n    rescue JWT::ExpiredSignature, JWT::VerificationError => e\\n        raise ManejadorDeExcepciones::TokenExpirado, e.message\\n    rescue JWT::DecodeError, JWT::VerificationError => e\\n        raise ManejadorDeExcepciones::TokenNoValido, e.message\\n    end\\nend\\n\")), mdx(\"p\", null, \"Dos funciones, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"encode\"), \" y \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"decode\"), \".\"), mdx(\"p\", null, \"La primera recibe dos parametros (aunque el segundo puede ser vacio y por defecto le pondr\\xE1 24 horas), y crea el token.\"), mdx(\"p\", null, \"La segunda solo recibe como parametro un token y lo decodifica, luego se hace un rescue para manejar los errores en caso de que el token haya vencido o no sea valido, este manejador de errores lo crearemos a continuaci\\xF3n, por lo tanto procedemos a crear un archivo en app/controllers/concerns/manejador_de_excepciones.rb\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"\\nmodule ManejadorDeExcepciones extend ActiveSupport::Concern\\n    class TokenNoValido < StandardError; end\\n    class TokenExpirado < StandardError; end\\n    included do\\n        rescue_from ManejadorDeExcepciones::TokenNoValido do |_error|\\n            render json: {mensaje: \\\"\\xA1Acceso denegado!. Token inv\\xE1lido suministrado.\\\"}, status: :unauthorized\\n        end\\n        rescue_from ManejadorDeExcepciones::TokenExpirado do |_error|\\n            render json: {mensaje: \\\"\\xA1Acceso denegado!. Token expirado\\\"}, status: :unauthorized\\n        end\\n    end\\nend\\n\")), mdx(\"p\", null, \"Est\\xE9 archivo recibira los errores de la clase JWT y los manejar\\xE1 para devolver el mensaje de error, ahora tenemos que incluirlo en el appliation_controller para poder utilizarlo en las dem\\xE1s clases\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class ApplicationController < ActionController::Base\\n    include ManejadorDeExcepciones\\nend\\n\")), mdx(\"p\", null, \"Ahora procedemos a crear una carpeta llamada auth (o como quieran) dentro de app y dentro un archivo authentication.rb que es donde estar\\xE1 la clase Authentication que ser\\xE1 la encargada de autenticar al usuario y generar el token, esperemos que se entienda con solo verla.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Authentication\\n    def initialize(usuario)\\n        @correo = usuario[:correo]\\n        @password = usuario[:password]\\n        @usuario = Usuario.find_by(correo: @correo)\\n    end\\n\\n    def autenticar\\n        @usuario && @usuario.authenticate(@password)\\n    end\\n\\n    def generar_token\\n        JsonWebToken.encode({usuario_id: @usuario.id, correo: @usuario.correo})\\n    end\\nend\\n\")), mdx(\"p\", null, \"teniendo esto, esperariamos que nuestra autenticaci\\xF3n ya funcionara, entonces la probamos creando una ruta al controlador de sesi\\xF3n en config/routes.rb (como estoy manejando las carpetas ap1 y v1 en mi proyecto colocar\\xE9 los namespace, si quieres los puedes obviar)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"Rails.application.routes.draw do\\n  namespace :api do\\n    namespace :v1 do\\n      post 'login', to: 'session#login'\\n    end\\n  end\\nend\\n\\n\")), mdx(\"p\", null, \"Ahora creamos los controladores para ir probando que todo funciona hasta aqu\\xED, quedar\\xEDa algo as\\xED (obviar las carpetas api y v1 si lo deseas)\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"264px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"63.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVQoz5WR207DMBBE/SUgiNd2YsfxPY6dS9PQNqhqxf9/DYrgkUIYzcNqpaPZ1SCeNDs7kz1hDGMAIPuNhKyH2Kno1OBoWf6LR2VZrYOzyTXZyWiAUMC7YS7q62yVVzI7PQVu5P5wVFX8dkk2GdGaOmhuJOyHCZTj0c9r4F5DAbiA7XJCvv07DEBUXd8vSWj5tdp4vDeZvFK2VvSouBhDHVSTnRpbPXjuGvxHMsZPGNbi5SRomawMivtGRi07I7yijBZFgR8IaWVZ4z6kvHnj35d8nuM8psucr29pPfo+NY1Vyv1oZEwbYroHs8TQnpc4Ty4l32ff96HPNnZah0dGmLAp1FOvWLSqt1vPBd5eohQowQD4sdAzkBPgtSRy6fTo9dTK1mzDIZpDK7z6pfZPcMmEMGmipyUAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"controladores\",\n    \"title\": \"controladores\",\n    \"src\": \"/static/8c860e0571326e6946d4d817247579b7/96573/controladores.png\",\n    \"srcSet\": [\"/static/8c860e0571326e6946d4d817247579b7/5243c/controladores.png 240w\", \"/static/8c860e0571326e6946d4d817247579b7/96573/controladores.png 264w\"],\n    \"sizes\": \"(max-width: 264px) 100vw, 264px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"y en session_controller\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Api::V1::SessionController < ApplicationController\\n    def login\\n        auth = Authentication.new(login_params)\\n        if(auth.autenticar)\\n            render json: {mensaje: \\\"\\xA1Inicio de sesi\\xF3n correcto!\\\", token: auth.generar_token}, status: :ok\\n        else\\n            render json: {mensaje: \\\"Correo o Contrase\\xF1a incorrectos\\\"}, status: :unauthorized\\n        end\\n    end\\n    private\\n    def login_params\\n        params.permit(:correo, :password)\\n    end\\nend\\n\")), mdx(\"p\", null, \"y luego para poder probar, ruby espera un csrf_token en cada solicitud pero aqu\\xED no lo utilizaremos por lo que nos toca deshabilitarlo agregando en application_controller \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"protect_from_forgery with: :null_session\"), \" y ahora si podremos probar (en mi caso lo har\\xE9 con postman y enviando el usuario que he creado en el seed como admin)\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"44.583333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVQoz52Qa0oFMQyFuzs36E8XI7gJV+DVmU7bSZvm0Uek94r6QxE8fBxOIBxIXIwxhBBj9P7Y9mP3PoQAACcAQL7yoZhOPMP9E9w9pMfnRBBcrZWoVqqIJflXzICITCRclUlF9JtE5ER9PbWQKqGDnEvGUjglzlCZmUVZtHFthE2lD+tjfjLnNJtjruz8cdRMCJKSVbI2rE/rN7+F33ExxmvZf+Rywd56770tH1f+kLa13PpwJWyIhQixYqVKeK47V9/PiAiSEEup5A6/nSEFX/zO+0ZhQ+HeurW2UP0KtzyGTVsvVFW37TtmOrZ+ebHLi71dLIOVYgCLnA3yh6+xGItpX7Rh742yCi/93ieCAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"primerPruebaLogin\",\n    \"title\": \"primerPruebaLogin\",\n    \"src\": \"/static/e37bfc860b0848e92ca390c98938bbe1/7d769/primerPruebaLogin.png\",\n    \"srcSet\": [\"/static/e37bfc860b0848e92ca390c98938bbe1/5243c/primerPruebaLogin.png 240w\", \"/static/e37bfc860b0848e92ca390c98938bbe1/ab158/primerPruebaLogin.png 480w\", \"/static/e37bfc860b0848e92ca390c98938bbe1/7d769/primerPruebaLogin.png 960w\", \"/static/e37bfc860b0848e92ca390c98938bbe1/977c6/primerPruebaLogin.png 1051w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"\\xA1Y hasta aqu\\xED todo est\\xE1 funcionando correctamente!\"), mdx(\"p\", null, \"pero hasta este punto todo el mundo puede hacer lo que le de la gana despues de haber obtenido el token, hasta un visitante podr\\xEDa eliminar o actualizar algo (en caso de tener creados los metodos en los controladores) y es cuando entra en juego la gema cancancan que es la que nos permitir\\xE1 gestionar que permisos tiene cada usuario dependiendo de su rol, y lo hace de una manera muy elegante, lo primero entonces es instalarla agregando \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gem 'cancancan'\"), \" en el Gemfile y luego como no ejecutar \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bundle install\"), \", a continuaci\\xF3n despues de instalada debemos ejecutar en consola \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rails g cancan:ability\"), \"  para que se cree el archivo ability.rb dentro de la carpeta app/models/, si da error pues lo crear manual xD.\"), mdx(\"p\", null, \"Una vez ubicado el archivo vemos que tiene la clase Ability creada y el inicializador de est\\xE1 misma, como nuestro proyecto tiene 3 roles lo que haremos es que cada vez que soliciten autorizaci\\xF3n les devolveremos una funci\\xF3n dependiendo del rol del usuario para saber que puede hacer y que no, as\\xED:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Ability\\n  include CanCan::Ability\\n\\n  def initialize(usuario)\\n    send(\\\"#{usuario.rol.nombre}_permisos\\\", usuario)\\n  end\\n\\n  def administrador_permisos(usuario)\\n    can :manage, :all\\n  end\\n  \\n  def cliente_permisos(usuario)\\n    can :read, Post, :all\\n    can :manage, Post, { usuario_id: usuario.id}\\n    can [:read, :update], Usuario, { id: usuario.id }\\n  end\\n\\n  def visitante_permisos(usuario)\\n    can :read, Post, :all\\n  end\\n\\n  def lista_de_permisos\\n    rules.map do |rule|\\n     object = { acciones: rule.actions, sobre: rule.subjects.map{ |s| s.is_a?(Symbol) ? s : s.name } }\\n      object[:condiciones] = rule.conditions unless rule.conditions.blank?\\n      object[:inverted] = true unless rule.base_behavior\\n      object\\n    end\\n  end\\nend\\n\\n\")), mdx(\"p\", null, \"Vemos  tres funciones una por cada rol, y lo que dice dentro de cada una es que el administrador puede hacer de todo, el cliente puede leer todos los post pero solo puede actualizar, crear, eliminar y borrar post que le pertenezcan a el y adem\\xE1s solo podra ver y actualizar un usuario si es el mismo, en cuando al visitante solamente puede leer todos los post, esto es maravilloso nos ahorramos hacer un monton de if (que yo habr\\xEDa hecho si esta gema no existiera xD) en cada controlador dependiendo del rol del usuario; tambien vemos un metodo llamado lista_de_permisos que este lo que nos retorna es que puede hacer cada rol, ahora lo vemos.\"), mdx(\"p\", null, \"Para probarlo en el controlador de usuarios escribiremos los siguientes metodos\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Api::V1::UsuariosController < ApplicationController\\n    def index\\n        usuarios = Usuario.all\\n        render json: usuarios, status: :ok\\n    end\\n\\n    def create\\n        usuario = Usuario.new(usuario_params)\\n        if usuario.save\\n            render json: usuario, status: :ok\\n        else\\n            render json: \\\"error\\\", status: :unprocessable_entity\\n        end\\n    end\\n\\n    def show\\n        usuario = Usuario.find(params[:id])\\n        permisos = Ability.new(usuario).lista_de_permisos\\n        render json: {usuario: usuario, permisos: permisos}, status: :ok\\n    end\\n\\n    private\\n    def usuario_params\\n        params.permit(:correo, :password, :rol_id)\\n    end\\nend\\n\")), mdx(\"p\", null, \"Y desde postman probamos con el usuario 1 que es el admin\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"844px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"49.583333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVQoz5WQ61LDIBBG8/4P6D911No0VxLugYbjQNqq1bGVnTMfl92PhUqIkbZtEULQNA2Hw4G6rotmhmFgmqab9H1ffCrnPNZanHNFjcmYMj+Tz25xzq1U84IzCmsdzlqUdHgXsNaUdYyREMJNcl6mGvqutCuVKq0rLZnljJKCRY4kIKV0N1XXddsTR4mRlhhgsSsxFKst1n8Y5o8PMWL7mcPDK+PO0D5B8wjtc0KPCTtzQY9gpsR6zBf+HMUwf6buZ1Qz4nVEi61obhPHsBWm7fEXSvzW4X7/XgzjElC9RovlVMRFt+Rrvd7bqOp6z7J4YMUIi9fHk9d300/9e1S73Rti0li/skQKPiR8+Kr38wGIvAxTNrSlnwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"lista de permisos admin\",\n    \"title\": \"lista de permisos admin\",\n    \"src\": \"/static/669e65972c014ff0373378857204b463/b4e2e/lista_de_permisos_admin.png\",\n    \"srcSet\": [\"/static/669e65972c014ff0373378857204b463/5243c/lista_de_permisos_admin.png 240w\", \"/static/669e65972c014ff0373378857204b463/ab158/lista_de_permisos_admin.png 480w\", \"/static/669e65972c014ff0373378857204b463/b4e2e/lista_de_permisos_admin.png 844w\"],\n    \"sizes\": \"(max-width: 844px) 100vw, 844px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Con el usuario 2 que es un usuario normal (cliente)\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"846px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"63.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQ4y6WTyXLCMBBE9f8/mQNgMBK2rB3J1kt5SYBLWDJVXTpMTatb0xJdr5FS0fc9bdtyOp1uaFuklPRaL/2/oJRa5oU+fqE7hXEOrTXDMCwEg9Y43RFjIqXniDESQkAo2S43DJ3GGENMEeccwTuK18xVa32KnxLN8UjwgewT/mJJ7vrbrC+S3UM0TbNInset8kRb7ul4t8Rut8NYT0yZYK8EV8ilUkYoY30bG2Egj5WusXTnzFghFxbi9Xwdq+UYV8tywJ0NJeePbYvD4UAIkVIKOSSuLlByYV7c7bF5GaJpVkKYcJeEUWWLCg9xeFnhbDlulofWYmR+OyoPsdnv94vCqU6E3uI7xzRNfFpi/qveB8ZxpG4L+I/Cb9ZY+1JdBwjyAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"lista de permisos cliente\",\n    \"title\": \"lista de permisos cliente\",\n    \"src\": \"/static/7795c527bf04bb5975620e710ec9a421/ccfff/lista_de_permisos_cliente.png\",\n    \"srcSet\": [\"/static/7795c527bf04bb5975620e710ec9a421/5243c/lista_de_permisos_cliente.png 240w\", \"/static/7795c527bf04bb5975620e710ec9a421/ab158/lista_de_permisos_cliente.png 480w\", \"/static/7795c527bf04bb5975620e710ec9a421/ccfff/lista_de_permisos_cliente.png 846w\"],\n    \"sizes\": \"(max-width: 846px) 100vw, 846px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"y vemos que por cada petici\\xF3n nos retorna los permisos del usuario, las acciones que puede hacer,  sobre que modelo y si tiene alguna condici\\xF3n para poder hacer esa acci\\xF3n, quiz\\xE1 para algo puede servir est\\xE9 metodo en algun momento.\"), mdx(\"p\", null, \"Pero continuemos con el proceso, ahora para que cancancan pueda saber que hacer al momento de hacer una petici\\xF3n a alg\\xFAn controlador donde definamos la autorizaci\\xF3n el asume que tenemos la clase ability (que ya la tenemos en la carpeta app/models) y tambien un metodo llamado current_user y por lo tanto este metodo es el que procederemos a escribir ahora, entonces nos vamos a app/controllers/application_controller.rb y es aqu\\xED donde escribiremos el metodo para poder tenerlo disponible en toda la aplicaci\\xF3n quedando as\\xED\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class ApplicationController < ActionController::Base\\n    protect_from_forgery with: :null_session\\n    include ManejadorDeExcepciones\\n\\n    rescue_from CanCan::AccessDenied do |exception|\\n        render json: { mensaje: exception.message }, status: 403\\n    end\\n\\n    def current_user\\n        if token\\n            @usuario_actual ||= Usuario.find(token[:usuario_id])\\n        else\\n            @usuario_actual ||= Usuario.new(rol_id: 3)\\n        end\\n    end\\n\\n    private\\n    def token\\n        valor = request.headers[:Authorization]\\n        return if valor.blank?\\n        @token ||= JsonWebToken.decode(valor.split(\\\" \\\").last)\\n    end\\nend\\n\\n\")), mdx(\"p\", null, \"Lo que agregamos ahora es un rescue para manejar el error cuando el acceso sea denegado y devolver un error de no autorizado, el metodo current user que recupera el usuario actual dependiendo del token que venga en la solicitud y en caso de no haber ningun token se tomar\\xE1 como usuario visitante por eso se le asigna el rol tres (asumo que el rol con id tres es el visitante, lo pueden hacer dinamico con una consulta a la tabla rols).\"), mdx(\"p\", null, \"Luego de esto volvemos el metodo show el usuarios_controller normal y le agregamos la directiva para que cancancan aplique la autorizaci\\xF3n en esa clase, as\\xED\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class Api::V1::UsuariosController < ApplicationController\\n    load_and_authorize_resource class: \\\"Usuario\\\"\\n\\n    def index\\n        usuarios = Usuario.all\\n        render json: usuarios, status: :ok\\n    end\\n\\n    def create\\n        usuario = Usuario.new(usuario_params)\\n        if usuario.save\\n            render json: usuario, status: :ok\\n        else\\n            render json: \\\"error\\\", status: :unprocessable_entity\\n        end\\n    end\\n\\n    def show\\n        usuario = Usuario.find(params[:id])\\n        render json: usuario, status: :ok\\n    end\\n\\n    private\\n    def usuario_params\\n        params.permit(:correo, :password, :rol_id)\\n    end\\nend\\n\")), mdx(\"p\", null, \"Y probamos!\"), mdx(\"p\", null, \"Pedimos el usuario con id 3 y enviamos el token del administrador, y lo devolver\\xE1 sin problemas pues el puede realizar est\\xE1 acci\\xF3n\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"845px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVQoz32R61LkIBBG8/6vuPtjtjQ6uQ0EkuYajgVRyxl1qTr1QV9p6JRSTOOI1pppmhmGgev12rSyLEvz/UbNP3Mn5nmms9ZirMWaFb3M6JvCGNNY15Xq3/edbdua/oSItLhKF2NAnCM5yzY+EYwi50xKiRAC3ntEXLP9RIyxNa96HAdd3/dopRDnKXBSyic1aLMrsm/knO58H/7avGo9d8MwttHqtauxlrxLqgliyM5SasGHho90QTbq2PXKFZFADLmNGkJ8tydSyp8xj5yxZ41Ov15Yb3P7GGNWrLGsxmJXjavveRRySuSUf33Hr3TLTaGURnZBxOPk/IQYHUcUzlXu+O/I4zTi7c7yp0c/G1RfmP+BvsKuwNuCM6Wp6HN/pPKtyQdd//KCulmmy8zyahl7GJ4Kz38Ly1hwviAC4mB/VxcKPoIP33kDCs0KJX6Yr7oAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"autorizacion admin\",\n    \"title\": \"autorizacion admin\",\n    \"src\": \"/static/e2d2357da4b9c6b051c136b8c256afed/9e11f/autorizacion_admin.png\",\n    \"srcSet\": [\"/static/e2d2357da4b9c6b051c136b8c256afed/5243c/autorizacion_admin.png 240w\", \"/static/e2d2357da4b9c6b051c136b8c256afed/ab158/autorizacion_admin.png 480w\", \"/static/e2d2357da4b9c6b051c136b8c256afed/9e11f/autorizacion_admin.png 845w\"],\n    \"sizes\": \"(max-width: 845px) 100vw, 845px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"pero si lo hacemos con el token de un usuario normal\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"847px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"42.91666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQoz41S2Y7DIAzk/z9zX5qkm3DYkGCOWZk2q2ylqmtpZHwNtsHM8wxrLe73O6Zpwu12G5imGcuyjNh/oDzrusKEEMBEcHaDsw4heHgf4L2HxmKMYOah3yGlBCIaeSbtO8rBoPkL+7qgFkEpFcdxDGhyzhm1VpRS/kB9mqNkp220XS1qraH3PvR5VkkxgiiMwmv8zFEivfD0DUJtW42H9Kd66CY7SgpoOf76rtJffEa0fZHRrkgZ4+qt8hxLRFcgqC/jlktcOzxtQ/YbPBZPCF4fKIEjIZJDKbq7s1je4EKeM4x+F7d5bJuHswy7EbaVwOuKvOt+OkQaauuo9TOM84wUMiI3RAI4AOwBJoA8EFxDTAW5AIf0j/gBZsK9H6k/yr8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"autorizacion usuario normal\",\n    \"title\": \"autorizacion usuario normal\",\n    \"src\": \"/static/c492a0193307f863484bf85188f7836b/44c02/autorizacion_usuario_normal.png\",\n    \"srcSet\": [\"/static/c492a0193307f863484bf85188f7836b/5243c/autorizacion_usuario_normal.png 240w\", \"/static/c492a0193307f863484bf85188f7836b/ab158/autorizacion_usuario_normal.png 480w\", \"/static/c492a0193307f863484bf85188f7836b/44c02/autorizacion_usuario_normal.png 847w\"],\n    \"sizes\": \"(max-width: 847px) 100vw, 847px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"igual sucede con el usuario visitante\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"850px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"43.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVQoz4WRWW7DMAwFff9j9iupV62WqGUKKnECFEVjYPC4iiQ8zfPMvu/M39/cbzduT+73O8uycBzHR7Rf6621TMYYnPfsxnIYh/qKFqp673HODf2LEMJAa1WnMyUkWuzti7SvlCKUUkgpDc7zRESotY74b7QmxvjKT4cxnDHQ5aSXRGtt0JXex3Z6QRYZ/pVvz3zOeQy9YpOeFmKkd55ff6laLQdqtEOv2FXT300ve9LJj5MKInrGY3W5VDK1yOCvk7VXtxy+CJM329jQB4c1juAjITiiOyj1Mej9gPxDIaeTaZkXjs2wrQZzeLbVsq2OsK5IauTUKLVRW6fWD7SuPyUQbSb4RvDgLTgD3j1ss1diqmSBJP0jP7WXvT7g5tjVAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"autorizacion visitante\",\n    \"title\": \"autorizacion visitante\",\n    \"src\": \"/static/64bd8d3561e6db83dc2af514d22b2677/f20d0/autorizacion_visitante.png\",\n    \"srcSet\": [\"/static/64bd8d3561e6db83dc2af514d22b2677/5243c/autorizacion_visitante.png 240w\", \"/static/64bd8d3561e6db83dc2af514d22b2677/ab158/autorizacion_visitante.png 480w\", \"/static/64bd8d3561e6db83dc2af514d22b2677/f20d0/autorizacion_visitante.png 850w\"],\n    \"sizes\": \"(max-width: 850px) 100vw, 850px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"El enviroment en postman contiene los tokens (el del visitante simplemente no es nada)\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"663px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"12.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAUElEQVQI143MQQoAIQhA0e5/WEuzxIU6KDSrgUZ4CIW/7b1jjBEiEjnu/snMAhELALx67yUbuZuqBjP/Cs45ywkfRFTvudtaq8r5kUe36M0D8+XqZKgNDoMAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"enviroment postman\",\n    \"title\": \"enviroment postman\",\n    \"src\": \"/static/b03688f342afb513554c423154209563/28b9b/enviroment_postman.png\",\n    \"srcSet\": [\"/static/b03688f342afb513554c423154209563/5243c/enviroment_postman.png 240w\", \"/static/b03688f342afb513554c423154209563/ab158/enviroment_postman.png 480w\", \"/static/b03688f342afb513554c423154209563/28b9b/enviroment_postman.png 663w\"],\n    \"sizes\": \"(max-width: 663px) 100vw, 663px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Y con est\\xE1s pruebas podemos ver que todo est\\xE1 funcionando correctamente!, ahora simplemente por deseo personal me gustar\\xEDa ver el mensaje de error en espa\\xF1ol y de forma personalizada, por lo que toca hacer lo siguiente, en config/locales/ crear\\xE9 el archivo es.yml y tendr\\xE1 lo siguiente\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"es:\\n  unauthorized:\\n    manage:\\n      all: \\\"No est\\xE1s autorizado para: [%{action}] => [%{subject}].\\\"\\n\")), mdx(\"p\", null, \"adem\\xE1s de esto en application_controller agregamos un before_action y le pasamos una funci\\xF3n para cambiar el locale de rails, quedar\\xEDa as\\xED\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ruby\"\n  }, \"class ApplicationController < ActionController::Base\\n    before_action :set_locale\\n    protect_from_forgery with: :null_session\\n    include ManejadorDeExcepciones\\n\\n    rescue_from CanCan::AccessDenied do |exception|\\n        render json: { mensaje: exception.message }, status: 403\\n    end\\n\\n    def current_user\\n        if token\\n            @usuario_actual ||= Usuario.find(token[:usuario_id])\\n        else\\n            @usuario_actual ||= Usuario.new(rol_id: 3)\\n        end\\n    end\\n\\n    private\\n    def token\\n        valor = request.headers[:Authorization]\\n        return if valor.blank?\\n        @token ||= JsonWebToken.decode(valor.split(\\\" \\\").last)\\n    end\\n    def set_locale\\n        I18n.locale = \\\"es\\\"\\n    end\\nend\\n\\n\")), mdx(\"p\", null, \"Haremos otra prueba y veremos los errores, en este caso trataremos de crear un nuevo usuario\"), mdx(\"p\", null, \"Token de visitante\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"853px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60.416666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVQoz7XSf0vEMAyA4X7/L+k/aq/n2q1b2q4/1le2O1FBvMPDwENCKCGUKOccxhj87Dm/GYzRaP3K6aSP/jg6pmm8yZjTkdVpL5zHvQxYkzg/F7zLxJRJa2G90/E2V5TWmmWJiA2EZSMGKA3qHylrLbVWPqM/RA3DQCnlMqp3ev+aP+r7/TDwMf8z8PsfPhbK+4mc87HlLqU9V9acydfefSpriiivnxDvkBAQmZFFEBGCeHJc2LZG2yqt3dIoeUW9DQPWjkxuxjlhGiPOBmYnhCmQV1hjp9RObb9rG5fDFknkuK/cj8NOV/HQCUsn58vQW94BtI+shLOVrL8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"crear usuario visitante\",\n    \"title\": \"crear usuario visitante\",\n    \"src\": \"/static/6256be829877f9b37f3f966ce51f823f/6fbab/crear_usuario_visitante.png\",\n    \"srcSet\": [\"/static/6256be829877f9b37f3f966ce51f823f/5243c/crear_usuario_visitante.png 240w\", \"/static/6256be829877f9b37f3f966ce51f823f/ab158/crear_usuario_visitante.png 480w\", \"/static/6256be829877f9b37f3f966ce51f823f/6fbab/crear_usuario_visitante.png 853w\"],\n    \"sizes\": \"(max-width: 853px) 100vw, 853px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Token usuario\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"841px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"47.91666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVQoz42S627DIAyFef+33J82TdIEMOGOz2TSpNXaTUP6BDb4gE+ihmHAsiwYxxuu10vn0ucB0zRhXdc/kVrhdrthHEcoIsK2eVjaOhJbQ33e97YT7/1HQghwznVUiBHZE+zwhXAfEX3A5jJyTv2gkFJCzhmllDckH2M8Y2UtIcUAzhFcIrg1MDe01iBDXkZuQ86l515h5i4onYiYxGqeZxA51NrAQE9y4y7KDJTokdyK4u0jx2/gqBNBUT5u28cx7yt5MbjKAuDn3nnmh7DKj95rrb2tkuvuzYtHPV/qrx4eHgvKLlP3yDmC0RZEHuQIzur+YUqVwnwWvPO8PMYEtdxnkDEw2sAa138ZowlR31FTQatAK3wY8Bl+AIYaZ43NJJCpsBow6461gOkxw2hGSP/jGyk1DHTtoh8lAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"crear usuario usuario\",\n    \"title\": \"crear usuario usuario\",\n    \"src\": \"/static/018cdd6136538501a7a5d23a099a2a40/20595/crear_usuario_usuario.png\",\n    \"srcSet\": [\"/static/018cdd6136538501a7a5d23a099a2a40/5243c/crear_usuario_usuario.png 240w\", \"/static/018cdd6136538501a7a5d23a099a2a40/ab158/crear_usuario_usuario.png 480w\", \"/static/018cdd6136538501a7a5d23a099a2a40/20595/crear_usuario_usuario.png 841w\"],\n    \"sizes\": \"(max-width: 841px) 100vw, 841px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Y por ultimo con el administrador\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"850px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.41666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz32S7W6cMBBFef8H7L8qqtossIsNNrbx94lsomySzdbS0Zi5M8bcYVjXlev1ipSS5XZjniemaWKe54/8tm1Paf0t3m43lmVh2PcdrRTGWJQ2J0qhNo3WmqZbazHG9PgTzrle1xhCCPgQiG5Hz385VoH3HmcTPniO4+jPMUZSSg+0/Gd9EEIg5UrwByUe1BQopVBro5JzRimNcwcp5a59puntZu3AVj9cLheEWHDHQS6VCl24U8jekJym5PiD3jLn6gemXEg59zedYn1oqCVByR+3/s75Red+MEoSDkfzMsaAs57gc/elexsjIcQen9F6w3vtoOc/KDGzG4PWqvuh9Y7RCq/l6VXOXynPGcS6IcSKNQ7rAtYEjPF9wjE4cqF7+1/yfT+M48i27Yy/XplfJNNLYfwN138gr7CJyrrUHhtKVqythFQJ8ZGh/eHWGuy0YuXOvsC+VORrxazvQyp8Ae6T/b7eAKGiWR33JG6LAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"crear usuario admin\",\n    \"title\": \"crear usuario admin\",\n    \"src\": \"/static/5134a859cb49a872f4a4fc0b2649a01f/f20d0/crear_usuario_admin.png\",\n    \"srcSet\": [\"/static/5134a859cb49a872f4a4fc0b2649a01f/5243c/crear_usuario_admin.png 240w\", \"/static/5134a859cb49a872f4a4fc0b2649a01f/ab158/crear_usuario_admin.png 480w\", \"/static/5134a859cb49a872f4a4fc0b2649a01f/f20d0/crear_usuario_admin.png 850w\"],\n    \"sizes\": \"(max-width: 850px) 100vw, 850px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Y as\\xED mismo pasar\\xEDa con los dem\\xE1s metodos, nuestra aplicaci\\xF3n tendr\\xE1 un manejo de autenticaci\\xF3n un autorizaci\\xF3n un poco m\\xE1s organizado y mejor elaborado graci\\xE1s a est\\xE1s gemas.\"), mdx(\"p\", null, \"Si alg\\xF3 no est\\xE1 bien escrito o hay algun error pido disculpas, para dudas o comentarios estoy en las redes como @JoralmoPro.\"), mdx(\"p\", null, \"Para escribir este tutorial me he guidao y tal vez copiado algun trozo de c\\xF3digo de \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/@noordean/authentication-with-jwt-in-rails-api-71102387c0b0\"\n  }, \"aqu\\xED\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/stalniy/rails-cancan-api-example\"\n  }, \"aqu\\xED\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/CanCanCommunity/cancancan/wiki/exception-handling\"\n  }, \"aqu\\xED\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://culttt.com/2016/01/20/implementing-roles-and-permissions-in-ruby-on-rails/\"\n  }, \"aqu\\xED\"), \" y \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://riptutorial.com/ruby-on-rails/example/10259/getting-started-with-cancan\"\n  }, \"aqu\\xED\"), \".\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://gitlab.com/JoralmoPro/authrubyonrailstutorial\"\n  }, \"Repositorio\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\xA1Nos vemos el linea!\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Como dice en el titulo del post trataré de hacer un tutorial de como implementar un sistema autenticación y de roles utilizando ROR, para…","timeToRead":6,"banner":null}},"pageContext":{"slug":"/authentication-and-managing-roles-with-ruby-on-rails","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["2744905544","3090400250","318001574"]}